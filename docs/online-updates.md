# Online Updates

exogui supports online updates for select platforms using [electron-updater](https://www.electron.build/online update).

## How It Works

### Update Detection

1. **Current Version**: Read from `package.json` at build time, embedded in the application
2. **Remote Version**: Fetched from `latest-linux.yml` (or `latest-mac.yml`/`latest.yml`) published to GitHub Releases
3. **Comparison**: Uses semantic versioning to determine if update is available

### Update Flow

```
App Startup (if enabled)
    ‚Üì
Wait 5 seconds (avoid slowing startup)
    ‚Üì
Check GitHub Releases for latest-*.yml
    ‚Üì
Compare versions: remote > current ?
    ‚Üì
If YES: Download update in background
    ‚Üì
Notify user: "Update ready, restart now or later?"
    ‚Üì
On restart: Install update automatically
```

### Configuration

Online updates can be enabled/disabled in config:

- **Location**: `config.json` (see [config.md](./config.md) for file location)
- **Setting**: `enableOnlineUpdate: true/false`
- **Default**: `true`

## Platform Support Matrix

| OS      | Format      | Support | Notes                                    |
|---------|-------------|---------|------------------------------------------|
| Linux   | AppImage    | ‚úÖ YES  | Fully supported, enabled by default      |
| Linux   | tar.gz      | ‚ùå NO   | No technical support in electron-updater |
| Linux   | Snap        | ‚äò N/A   | Snap Store handles updates               |
| Linux   | Flatpak     | ‚äò N/A   | Flathub handles updates                  |
| Linux   | deb/rpm     | ‚äò N/A   | System package manager handles updates   |
| Windows | NSIS (.exe) | üîí DIS  | Requires code signing certificate        |
| Windows | ZIP         | ‚ùå NO   | No technical support in electron-updater |
| macOS   | DMG         | üîí DIS  | Requires code signing + notarization     |

### Legend

- **‚úÖ YES**: Supported and enabled
- **‚ùå NO**: Not technically possible (electron-updater limitation)
- **‚äò N/A**: Not applicable (external update mechanism)
- **üîí DIS**: Technically supported but disabled (requires paid certificates)

## Technical Details

### Version Sources

**Current Version:**
```json
// package.json (baked into app at build time)
{
  "version": "1.2.3"
}
```

**Remote Version:**
```yaml
# latest-linux.yml (auto-generated by electron-builder)
version: 1.2.4
files:
  - url: exogui-1.2.4.AppImage
    sha512: <hash>
    size: 123456789
```

### Update Requirements

For online updates to work:

1. ‚úÖ App must be **packaged** (not development build)
2. ‚úÖ Platform must be **supported** (see matrix above)
3. ‚úÖ `enableOnlineUpdate` config set to `true`
4. ‚úÖ GitHub release must be **published** (not draft)
5. ‚úÖ Release must contain `latest-*.yml` manifest file
6. ‚úÖ Internet connection available

### Linux AppImage Updates

AppImage has built-in update support:
- Downloads new AppImage to temporary location
- Verifies SHA512 checksum
- On restart: Replaces old AppImage with new one
- Old AppImage is deleted

**Important:** AppImage must be in a **writable location** (not mounted read-only filesystem).

## Publishing Updates

### For Maintainers

To publish a new version with online-updates:

```bash
# 1. Bump version in package.json
vim package.json  # Change version: 1.2.3 ‚Üí 1.2.4

# 2. Commit changes
git add package.json
git commit -m "chore: bump version to 1.2.4"

# 3. Build and publish (creates GitHub release automatically)
npm run publish:linux  # For Linux AppImage

# electron-builder will:
# - Build exogui-1.2.4.AppImage
# - Generate latest-linux.yml with version: 1.2.4
# - Create GitHub release with tag v1.2.4
# - Upload both files to the release
```

### Manual GitHub Release

If publishing manually:

1. Build the app: `npm run release:linux`
2. Find built files in `./dist/`
3. Create GitHub release with tag `vX.Y.Z`
4. Upload **both** files:
   - `exogui-X.Y.Z.AppImage`
   - `latest-linux.yml`
5. Publish the release (not draft)

## Troubleshooting

### Updates Not Detected

**Check:**
1. Is `enableOnlineUpdate` set to `true` in config.json?
2. Is the app running as packaged AppImage? (check `process.env.APPIMAGE`)
3. Is there a newer version published on GitHub?
4. Does the GitHub release contain `latest-linux.yml`?
5. Is the release marked as "Published" (not draft)?

**View logs:**
```bash
# Run AppImage from terminal to see update logs
./exogui-1.2.3.AppImage

# Look for lines starting with:
[AutoUpdater] Checking for updates...
[AutoUpdater] Update available: 1.2.4
[AutoUpdater] Update downloaded: 1.2.4
```

### Disable Auto-Updates

**Option 1: Via Config**
Edit `config.json` (see [config.md](./config.md)):
```json
{
  "enableOnlineUpdate": false
}
```

**Option 2: Via Environment Variable**
```bash
# Not currently supported, but could be added
```

## Future Plans

Potential future enhancements:

- [ ] Windows NSIS support (when code signing certificate available)
- [ ] macOS DMG support (when Apple Developer account + notarization available)
- [ ] Update channel selection (stable/beta)
- [ ] Manual "Check for Updates" button in UI
- [ ] Update download progress indicator
- [ ] Release notes display

## Related Documentation

- [Configuration Files](./config.md) - Description of the configuration files
- [electron-updater](https://www.electron.build/online update) - Official documentation
- [GitHub Releases](https://github.com/margorski/exodos-launcher/releases) - Published releases
